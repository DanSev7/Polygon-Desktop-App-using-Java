package Gui;

import Logic.*;
import javax.swing.*;
import javax.swing.border.*;
import javax.swing.table.*;
import java.awt.*;
import java.text.DecimalFormat;

public class PolygonAppUI extends JFrame {
    private final DecimalFormat df = new DecimalFormat("#,##0.######");
    
    // Modern Professional Palette
    private final Color MAIN_BG = new Color(240, 242, 245);
    private final Color SIDEBAR_DARK = new Color(33, 47, 61);
    private final Color SKY_BLUE_BTN = new Color(135, 206, 250); 
    private final Color BTN_TEXT = new Color(31, 44, 57);      
    private final Color CARD_WHITE = Color.WHITE;
    private final Color CONSOLE_BG = new Color(25, 25, 25);
    private final Color SELECTION_BLUE = new Color(180, 215, 255);
    private final Color ERROR_TEXT = new Color(255, 120, 0); // Warning Orange

    public static void main(String[] args) {
        SwingUtilities.invokeLater(() -> {
            try {
                UIManager.setLookAndFeel(UIManager.getSystemLookAndFeelClassName());
            } catch (Exception ignored) {}
            new PolygonAppUI().setVisible(true);
        });
    }

    public PolygonAppUI() {
        setTitle("N-Gon Polygon Computing System");
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        setSize(1050, 850);
        setLocationRelativeTo(null);
        setLayout(new BorderLayout());

        add(createSidebar(), BorderLayout.WEST);

        JTabbedPane workArea = new JTabbedPane();
        workArea.setFont(new Font("Segoe UI", Font.BOLD, 12));
        workArea.addTab(" REGULAR POLYGON ", createRegularWorkspace());
        workArea.addTab(" ARBITRARY POLYGON ", createArbitraryWorkspace());
        
        add(workArea, BorderLayout.CENTER);
    }

    private JPanel createSidebar() {
        JPanel side = new JPanel();
        side.setBackground(SIDEBAR_DARK);
        side.setPreferredSize(new Dimension(180, getHeight()));
        JLabel title = new JLabel("<html><body style='text-align:center; color:white;'><br><br>N-gon Polygon<br><b>Computing System</b></body></html>");
        title.setFont(new Font("Segoe UI", Font.PLAIN, 18));
        side.add(title);
        return side;
    }

    // --- REGULAR POLYGON WORKSPACE (with n>=3, L>0, H>=0) ---
    private JPanel createRegularWorkspace() {
        JPanel main = new JPanel(new BorderLayout(20, 20));
        main.setBackground(MAIN_BG);
        main.setBorder(new EmptyBorder(30, 30, 30, 30));

        JPanel inputCard = createStyledCard("Regular Polygon Parameters");
        inputCard.setLayout(new GridLayout(3, 2, 15, 15));
        
        JTextField nf = createStyledTextField("3");
        JTextField sf = createStyledTextField("1.0");
        JTextField hf = createStyledTextField("0.0");
        
        inputCard.add(new JLabel("Number of Sides (n ≥ 3):")); inputCard.add(nf);
        inputCard.add(new JLabel("Side Length (L > 0):"));      inputCard.add(sf);
        inputCard.add(new JLabel("Prism Height (H ≥ 0):"));    inputCard.add(hf);

        JTextArea console = createConsoleArea();
        
        JButton computeBtn = createActionBtn("PERFORM COMPLETE CALCULATION", e -> {
            try {
                int n = Integer.parseInt(nf.getText().trim());
                double s = Double.parseDouble(sf.getText().trim());
                double h = Double.parseDouble(hf.getText().trim());

                // Validation Logic
                if (n < 3) throw new IllegalArgumentException("Sides (n) must be at least 3.");
                if (s <= 0) throw new IllegalArgumentException("Side Length (L) must be greater than 0.");
                if (h < 0) throw new IllegalArgumentException("Prism Height (H) cannot be negative.");

                RegularPolygon poly = new RegularPolygon(n, s);
                Prism prism = new Prism(poly.getArea(), h);
                
                showSuccess(console);
                String shapeName = getPolygonName(n).toUpperCase();
                
                StringBuilder res = new StringBuilder();
                res.append(">> ANALYSIS COMPLETE: ").append(shapeName).append("\n");
                res.append("--------------------------------------------------\n");
                res.append(String.format("   Base Area:            %s\n", df.format(poly.getArea())));
                res.append(String.format("   Perimeter:            %s\n", df.format(poly.getPerimeter())));
                res.append(String.format("   Prism Volume:         %s\n", df.format(prism.getVolume())));
                res.append("--------------------------------------------------");
                console.setText(res.toString());

            } catch (NumberFormatException nfe) {
                showError(console, "Please enter valid numeric values.");
            } catch (IllegalArgumentException iae) {
                showError(console, iae.getMessage());
            }
        });

        JPanel topSection = new JPanel(new BorderLayout(15, 15));
        topSection.setOpaque(false);
        topSection.add(inputCard, BorderLayout.CENTER);
        topSection.add(computeBtn, BorderLayout.SOUTH);

        main.add(topSection, BorderLayout.NORTH);
        main.add(new JScrollPane(console), BorderLayout.CENTER);
        return main;
    }

    // --- ARBITRARY POLYGON WORKSPACE (with H>=0) ---
    private JPanel createArbitraryWorkspace() {
        JPanel main = new JPanel(new BorderLayout(20, 20));
        main.setBackground(MAIN_BG);
        main.setBorder(new EmptyBorder(30, 30, 30, 30));

        String[] cols = {"X Coordinate", "Y Coordinate"};
        DefaultTableModel model = new DefaultTableModel(cols, 0);
        model.addRow(new Object[]{"1", "1"});
        model.addRow(new Object[]{"0", "1"});
        model.addRow(new Object[]{"0", "0"});
        
        JTable table = new JTable(model);
        styleTable(table);

        JPanel heightCard = new JPanel(new FlowLayout(FlowLayout.LEFT));
        heightCard.setOpaque(false);
        JTextField hf = createStyledTextField("3.0");
        heightCard.add(new JLabel("Prism Height (H ≥ 0): "));
        heightCard.add(hf);

        JTextArea console = createConsoleArea();

        JPanel btnRow = new JPanel(new FlowLayout(FlowLayout.LEFT, 10, 0));
        btnRow.setOpaque(false);
        JButton addBtn = createActionBtn("+ ADD VERTEX", e -> model.addRow(new Object[]{"0", "0"}));
        JButton remBtn = createActionBtn("- REMOVE ROW", e -> {
            int sel = table.getSelectedRow();
            if(sel == -1) JOptionPane.showMessageDialog(this, "Select a row to remove.");
            else model.removeRow(sel);
        });
        
        JButton computeBtn = createActionBtn("COMPUTE ARBITRARY SHAPE", e -> {
            if (table.isEditing()) table.getCellEditor().stopCellEditing();
            runArbitraryCalc(model, hf, console);
        });
        
        btnRow.add(addBtn);
        btnRow.add(remBtn);
        btnRow.add(computeBtn);

        JPanel centerPanel = new JPanel(new BorderLayout(10, 10));
        centerPanel.setOpaque(false);
        centerPanel.add(heightCard, BorderLayout.NORTH);
        centerPanel.add(new JScrollPane(table), BorderLayout.CENTER);
        centerPanel.add(btnRow, BorderLayout.SOUTH);

        main.add(centerPanel, BorderLayout.CENTER);
        main.add(new JScrollPane(console), BorderLayout.SOUTH); 
        return main;
    }

    private void runArbitraryCalc(DefaultTableModel model, JTextField hf, JTextArea out) {
        try {
            int rows = model.getRowCount();
            if (rows < 3) throw new IllegalArgumentException("Polygon requires at least 3 vertices.");

            double h = Double.parseDouble(hf.getText().trim());
            if (h < 0) throw new IllegalArgumentException("Prism Height (H) cannot be negative.");

            double[] xs = new double[rows];
            double[] ys = new double[rows];
            for (int i = 0; i < rows; i++) {
                xs[i] = Double.parseDouble(model.getValueAt(i, 0).toString().trim());
                ys[i] = Double.parseDouble(model.getValueAt(i, 1).toString().trim());
            }

            ArbitraryPolygon poly = new ArbitraryPolygon(xs, ys);
            Prism prism = new Prism(poly.getArea(), h);

            showSuccess(out);
            out.setText(">> ARBITRARY ANALYSIS SUCCESSFUL\n" +
                        "--------------------------------------------------\n" +
                        "   Number of Vertices:  " + rows + "\n" +
                        "   Computed Base Area:  " + df.format(poly.getArea()) + "\n" +
                        "   Total Perimeter:     " + df.format(poly.getPerimeter()) + "\n" +
                        "   Prism Volume (H=" + h + "): " + df.format(prism.getVolume()) + "\n" +
                        "--------------------------------------------------");
        } catch (Exception ex) { showError(out, ex.getMessage()); }
    }

    // --- UI FORMATTING HELPERS ---

    private void showError(JTextArea out, String msg) {
        out.setForeground(ERROR_TEXT);
        out.setText("!! CALCULATION ERROR\n--------------------------------------------------\n" + msg);
    }

    private void showSuccess(JTextArea out) {
        out.setForeground(new Color(100, 210, 255));
    }

    private String getPolygonName(int n) {
        return switch (n) {
            case 3 -> "Triangle"; case 4 -> "Quadrilateral"; case 5 -> "Pentagon";
            case 6 -> "Hexagon"; case 8 -> "Octagon"; default -> n + "-gon";
        };
    }

    private JButton createActionBtn(String text, java.awt.event.ActionListener al) {
        JButton btn = new JButton(text);
        btn.setBackground(SKY_BLUE_BTN);
        btn.setForeground(BTN_TEXT);
        btn.setFont(new Font("Segoe UI", Font.BOLD, 12));
        btn.setFocusPainted(false);
        btn.setCursor(new Cursor(Cursor.HAND_CURSOR));
        btn.setBorder(BorderFactory.createCompoundBorder(
            new LineBorder(SKY_BLUE_BTN.darker(), 1), new EmptyBorder(12, 20, 12, 20)));
        btn.addActionListener(al);
        return btn;
    }

    private JPanel createStyledCard(String title) {
        JPanel p = new JPanel();
        p.setBackground(CARD_WHITE);
        p.setBorder(BorderFactory.createTitledBorder(
            new LineBorder(new Color(210, 210, 210)), title, 
            TitledBorder.LEFT, TitledBorder.TOP, new Font("Segoe UI", Font.BOLD, 12)));
        return p;
    }

    private JTextField createStyledTextField(String text) {
        JTextField f = new JTextField(text, 10);
        f.setFont(new Font("Segoe UI", Font.PLAIN, 14));
        f.setBorder(BorderFactory.createCompoundBorder(new LineBorder(Color.LIGHT_GRAY), new EmptyBorder(5, 5, 5, 5)));
        return f;
    }

    private JTextArea createConsoleArea() {
        JTextArea ta = new JTextArea(8, 40);
        ta.setEditable(false);
        ta.setBackground(CONSOLE_BG);
        ta.setForeground(new Color(100, 210, 255));
        ta.setFont(new Font("Consolas", Font.PLAIN, 15));
        ta.setBorder(new EmptyBorder(15, 15, 15, 15));
        ta.setText("System monitoring active...");
        return ta;
    }

    private void styleTable(JTable table) {
        table.setShowGrid(true);
        table.setGridColor(new Color(220, 220, 220));
        table.setRowHeight(30);
        table.setSelectionBackground(SELECTION_BLUE);
        table.setSelectionForeground(Color.BLACK);
    }
}